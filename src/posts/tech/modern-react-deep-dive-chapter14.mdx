---
slug: modern-react-deep-dive-chapter14
title: 《모던 리액트 Deep Dive》 14장 웹사이트 보안을 위한 리액트와 웹페이지 보안 이슈
date: 2024-10-23
description: 모던 리액트 Deep Dive 책의 14장을 읽으며 공부한 내용을 공유합니다.
category: react
tag: tech
---

# 리액트에서 발생하는 크로스 사이트 스크립팅 (XSS)
- 크로스 사이트 스크립팅이란 웹사이트 개발자가 아닌 제3자가 웹사이트에 악성 스크립트를 삽입해 실행할 수 있는 취약점을 의미. 이 취약점은 일반적으로 게시판과 같이 사용자가 입력을 할 수 있고, 이 입력을 다른 사용자에게 보여줄 수 있는 경우에 발생
- 리액트에서 XSS 이슈가 발생되는 경우
    - dangerouslySetinnerHTML prop
        - dangerouslySetinnerHTML 은 특정 브라우저 DOM의 innerHTML 을 특정한 내용으로 교체할 수 있는 방법으로 props 로 넘겨주는 __html 문자열에 제한이 없기 때문에 검증이 필요함.
    - useRef 를 활용한 직접 삽입
        - useRef 를 활용하면 직접 DOM 에 접근할 수 있으므로 dangerouslySetinnerHTML 과 비슷하게
        - 보안 취약점이 있는 스크립트를 삽입하면 동일한 문제가 발생함.
- 리액트에서 XSS 문제를 피하는 방법 : 제3자가 삽입할 수 있는 HTML 을 안전한 HTML 코드로 한 번 치환하는 것. 이러한 과정을 새니타이즈 또는 이스케이프라고 하는데, 다양한 라이브러리를 활용하여 적용할 수 있음.
<br /> <br />

# getServerSideProps 와 서버 컴포넌트를 주의하자
- 서버에는 일반 사용자에게 노출되면 안 되는 정보들이 담겨 있기 때문에 클라이언트, 즉 브라우저에 정보를 내려줄 때는 조심해야 함.
- getServerSideProps가 반환하는 props 값은 모두 사용자의 HTML 에 기록되고, 또한 전역 변수로 등록되어 스크립트로 충분히 접근할 수 있는 보안 위협에 노출되는 값이 됨. 또한 충분히 getServerSideProps 에서 처리할 수 있는 리다이렉트가 클라이언트에서 실행되어 성능 측면에서도 손해를 보게 됨. 따라서 getServerSideProps 가 반환하는 값 또는 서버 컴포넌트가 클라이언트 컴포넌트에 반환하는 props 는 반드시 필요한 값으로만 철저하게 제한되어야 함. 이는 보안 측면의 이점 뿐 아니라 성능 측면에서도 이점을 가져다 줄 수 있음.

<br /> <br />

# <a> 태그의 값에 적절한 제한을 둬야 한다
- `<a> 태그는 반드시 페이지 이동이 있을 때만 사용하고, 페이지 이동 없이 어떠한 핸들러만 작동시키고 싶다면 <a> 보다는 <button>을 사용하는 것이 좋음`
- 피싱 사이트로 이동하는 것을 막기 위해 origin 확인 후 처리하는 것이 좋음
<br /> <br />

# HTTP 보안 헤더 설정하기
- HTTP 보안 헤더란 브라우저가 렌더링하는 내용과 관련된 보안 취약점을 미연에 방지하기 위해 브라우저와 함께 작동하는 헤더를 의미.
- 보안 헤더 종류
    - Strict-Transport-Security 응답 헤더 : 모든 사이트가 HTTPS 를 통해 접근해야 하며, 만약 HTTP 로 접근하는 경우의 모든 시도는 HTTPS 로 변경되게 함.
        - `<expire-time>` 은 이 설정을 브라우저가 기억해야 하는 시간을 의미
        - includeSubDomains 가 있을 경우 이러한 규칙이 모든 하위 도메인에도 적용됨
    - X-XSS-Protection : 페이지에서 XSS 취약점이 발견되면 페이지 로딩을 중단하는 헤더로, 현재 사파리와 구형 브라우저에서만 제공되는 기능.
    - X-Frame-Options : 페이지를 frame, iframe, embed, object 내부에서 렌더링을 허용할 지 나타낼 수 있음
    - Permissions-Policy : 웹사이트에서 사용할 수 있는 기능과 사용할 수 없는 기능을 명시적으로 선언하는 헤더. 개발자는 다양한 브라우저의 기능이나 API를 선택적으로 활성화하거나 필요에 따라서는 비활성화할 수 있는데 여기서 말하는 기능이란 카메라나 GPS 와 같이 브라우저에서 제공하는 기능을 의미.
    - X-Content-Type-Options : Content-Type 에서 제공하는 MIME 유형이 브라우저에 의해 임의로 변경되지 않게 해주는 헤더로 웹서버가 브라우저에 강제로 이 파일을 읽는 방식을 지정하는 것.
    - Referrer-Policy : HTTP 요청에는 Referer 라는 헤더가 존재하는데 이 헤더에는 현재 요청을 보낸 페이지의 주소가 나타남. Referrer-Policy 헤더는 이 Referer 헤더에서 사용할 수 있는 데이터를 나타냄.
    - Content-Security-Policy : 콘텐츠 보안 정책(Content-Security-Policy, 이하 CSP)은 XSS 공격이나 데이터 삽입 공격과 같은 다양한 보안 위협을 막기 위해 설계되었음.
        - 대표적인 지시문 종류
            - src : font-src, img-src, script-src 등 다양한 src 를 제어할 수 있는 지시문
            - form-action : 폼 양식으로 제출할 수 있는 URL을 제한할 수 있음.
- 보안 헤더 설정하기
    - Next.js 에선 next.config.js 파일에서 애플리케이션 보안을 위해 HTTP 경로별로 보안 헤더를 적용할 수 있음. [레퍼런스](https://nextjs.org/docs/app/api-reference/config/next-config-js/headers)
    - 정적인 파일을 제공하는 NGNIX 의 경우 경로별로 add_header 지시자를 사용해 원하는 응답 헤더를 추가할 수 있음
- 보안 헤더 확인하기 : Analyse your HTTP response headers  사이트를 방문해 헤더를 확인하고 싶은 웹사이트의 주소를 입력하면 현재 보안 헤더 상황을 알 수 있음. [레퍼런스](https://securityheaders.com/)

<br /> <br />

# 취약점이 있는 패키지의 사용을 피하자
- [Snyk Vulnerability Database | Snyk](https://security.snyk.io/)  를 방문해 사용하는 패키지 이름으로 검색해 보면 현재 라이브러리의 취약점을 한눈에 파악할 수 있으므로 패키지 보안 이슈를 추적하는 데 많은 도움이 됨.

<br /> <br />

# OWASP Top 10
- OWASP 은 Open Worldwide Web Application Security Project라는 오픈소스 웹 애플리케이션 보안 프로젝트를 의미하는데 주로 웹에서 발생할 수 있는 정보 노출, 악성 스크립트, 보안 취약점 등을 연구하며, 주기적으로 10대 웹 애플리케이션 취약점을 공개하는데 이를 OWASP Top 10 이라고 함. [OWASP Top Ten | OWASP Foundation](https://owasp.org/www-project-top-ten/)
<br /> <br />